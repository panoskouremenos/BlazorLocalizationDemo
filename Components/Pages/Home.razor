@page "/"
@using System.Globalization
@using Microsoft.Extensions.Localization

@inject IStringLocalizer<SharedResources> Localizer
@inject NavigationManager Navigation

<PageTitle>Home</PageTitle>

<h3>@Localizer["Title"]</h3>
<p>@Localizer["Welcome"]</p>

<p>
    Culture: @System.Globalization.CultureInfo.CurrentUICulture.Name
</p>

<div>
    <select value="@currentCulture" @onchange="ChangeLanguage">
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
    </select>
</div>

@code {
    private string currentCulture; 
    protected override void OnInitialized()
    {
       currentCulture = CultureInfo.CurrentCulture.Name;   // Keeps the current selected culture in the dropdown menu
    }

    // Navigate to the culture endpoint which sets the cookie and reloads the page
    private void ChangeLanguage(ChangeEventArgs e)
    {
        var culture = e.Value?.ToString() ?? "en";
        var returnUrl = Uri.EscapeDataString(Navigation.Uri);

        Navigation.NavigateTo(
            $"/culture/set?culture={culture}&returnUrl={returnUrl}",
            forceLoad: true);
    }
}